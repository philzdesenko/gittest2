{"job":{"components":{"83936":{"id":83936,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":512,"y":-64,"width":32,"height":32,"inputConnectorIDs":[83943],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python Script 0"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import requests\n\nurl = \"https://mtln-dev-ed.my.salesforce.com/services/Soap/c/54.0/00D0Y000000pO7p\"\n\npayload = '''<SOAP-ENV:Envelope xmlns:SOAP-ENV=\\\"http://schemas.xmlsoap.org/soap/envelope/\\\" SOAP-ENV:encodingStyle=\\\"http://schemas.xmlsoap.org/soap/encoding/\\\" xmlns=\\\"urn:enterprise.soap.sforce.com\\\">\n\t<SOAP-ENV:Header>\n    \t<QueryOptions><batchSize>2000</batchSize> </QueryOptions>\n        <SessionHeader xmlns=\\\"urn:enterprise.soap.sforce.com\\\">\n        \t<sessionId>{}</sessionId>\n        </SessionHeader>\n     </SOAP-ENV:Header>\n     <SOAP-ENV:Body>\n     \t<query xmlns=\\\"urn:enterprise.soap.sforce.com\\\">\n        \t<queryString>SELECT Id,Name,Type FROM Account</queryString>\n        </query>\n     </SOAP-ENV:Body>\n    </SOAP-ENV:Envelope>'''.format(sf_access_token)\n\n#print(payload)\nheaders = {\n  'Content-Type': 'text/xml',\n  'SOAPAction': 'urn:enterprise.soap.sforce.com/query',\n  'Cookie': 'BrowserId=Kx0Gl2VDEe2bxrGNOLANkA; CookieConsentPolicy=0:1; LSKey-c$CookieConsentPolicy=0:1'\n}\n\nresponse = requests.request(\"POST\", url, headers=headers, data=payload)\n\nprint(response.text)\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"83937":{"id":83937,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":304,"y":-96,"width":32,"height":32,"inputConnectorIDs":[83940],"outputSuccessConnectorIDs":[83942,83943],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Get Salesforce access token"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import requests\nimport json\n\nurl = \"https://mtln-dev-ed.my.salesforce.com/services/oauth2/token\"\n\ngrant_type = 'grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Ajwt-bearer'\njwt_token='assertion=' + jwt_token\npayload='{}&{}'.format(grant_type, jwt_token)\nheaders = {\n  'Content-Type': 'application/x-www-form-urlencoded'\n}\n\nresponse = requests.request(\"POST\", url, headers=headers, data=payload)\n\naccess_token = response.json().get(\"access_token\")\n\ncontext.updateVariable('sf_access_token', access_token)"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"83938":{"id":83938,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1121667926,"x":528,"y":-160,"width":32,"height":32,"inputConnectorIDs":[83942],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Salesforce Query 0"}}}},"visible":true},"2":{"slot":2,"name":"Basic/Advanced Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Advanced"}}}},"visible":true},"3":{"slot":3,"name":"Authentication","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"kalyan not configured"}}}},"visible":false},"6":{"slot":6,"name":"Data Source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"7":{"slot":7,"name":"Data Selection","elements":{},"visible":false},"8":{"slot":8,"name":"Data Source Filter","elements":{},"visible":false},"9":{"slot":9,"name":"Combine Filters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":false},"10":{"slot":10,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT * from Account limit 100"}}}},"visible":true},"11":{"slot":11,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"100"}}}},"visible":false},"12":{"slot":12,"name":"Connection Options","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"initiateoauth"},"2":{"slot":2,"type":"STRING","value":"OFF"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"OAuthAccessToken"},"2":{"slot":2,"type":"STRING","value":"${sf_access_token}"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"LoginURL"},"2":{"slot":2,"type":"STRING","value":"https://mtln-dev-ed.my.salesforce.com/services/Soap/c/53.0"}}}},"visible":true},"13":{"slot":13,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"14":{"slot":14,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"15":{"slot":15,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"delme"}}}},"visible":true},"16":{"slot":16,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"17":{"slot":17,"name":"S3 Staging Area","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"18":{"slot":18,"name":"Primary Keys","elements":{},"visible":true},"20":{"slot":20,"name":"Data Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Salesforce"}}}},"visible":false},"102":{"slot":102,"name":"Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"103":{"slot":103,"name":"Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"104":{"slot":104,"name":"Security Token","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"105":{"slot":105,"name":"Use Sandbox","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"1001":{"slot":1001,"name":"","elements":{},"visible":false},"1013":{"slot":1013,"name":"Auto Debug","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Off"}}}},"visible":true},"1014":{"slot":1014,"name":"Debug Level","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"3"}}}},"visible":false},"1015":{"slot":1015,"name":"Authentication Method","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Other"}}}},"visible":true},"1992":{"slot":1992,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"1993":{"slot":1993,"name":"Use Accelerated Endpoint","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"1994":{"slot":1994,"name":"Stage","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"1995":{"slot":1995,"name":"Stage Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"1996":{"slot":1996,"name":"Stage Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"1997":{"slot":1997,"name":"New Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"1998":{"slot":1998,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"1999":{"slot":1999,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":false},"2000":{"slot":2000,"name":"Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Standard"}}}},"visible":true},"40000":{"slot":40000,"name":"Encryption","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":false},"40001":{"slot":40001,"name":"KMS Key ID","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"40501":{"slot":40501,"name":"","elements":{},"visible":false},"40502":{"slot":40502,"name":"Load Options","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"On"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"Off"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"On"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"On"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"Gzip"}}}},"visible":true},"63319":{"slot":63319,"name":"Stage Authentication","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Credentials"}}}},"visible":false},"63320":{"slot":63320,"name":"Storage Account","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"63321":{"slot":63321,"name":"Blob Container","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"63322":{"slot":63322,"name":"Storage Integration","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"84533":{"slot":84533,"name":"Storage Integration","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"88340":{"slot":88340,"name":"","elements":{},"visible":false},"88341":{"slot":88341,"name":"Stage Platform","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Snowflake Managed"}}}},"visible":true},"88342":{"slot":88342,"name":"Stage Authentication","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Credentials"}}}},"visible":false},"88343":{"slot":88343,"name":"Storage Integration","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"88344":{"slot":88344,"name":"Use Accelerated Endpoint","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"88345":{"slot":88345,"name":"Stage","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Custom]"}}}},"visible":true},"98776":{"slot":98776,"name":"GCS Staging Area","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"83939":{"id":83939,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-96,"y":-96,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[83945],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Start","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"83941":{"id":83941,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":160,"y":-96,"width":32,"height":32,"inputConnectorIDs":[83945],"outputSuccessConnectorIDs":[83940],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"build JWT token"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print (myvar)\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print (context.getGridVariable('mygridvar'))\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\nimport jwt\nfrom datetime import datetime, timedelta\n\n#epoch \n# +timedelta() to add 3 minutes from now.\n# /60*60 ro round off to an integer\nexpiry_epoch = int(((datetime.now()+ timedelta(minutes=3)).timestamp()//60*60))\n\n#print (expiry_epoch)\n\nmysecret='''-----BEGIN RSA PRIVATE KEY-----\nMIIEpQIBAAKCAQEA6H7dUSHX1XS/YuQZfgo5mfV25kE3eouX5LayzPXllUF9XXo7\nws+2DVAZhEsJd5PSWVC7In+JeKyBUvEshS7Sl1naG9ShdmpOFfFroV+Mt/sujYTf\nG0dd36xzTQSk6rzQt03d2/JuB1Dh0EW32Lp94Mb0/BE38OAFZq4Tv/Pzl6D+yWyO\nPEItuzO9Bf0X6evBwFiNHj2hQ2KozdzbJvhE9LrhMRm5QcIRtG4SUrlgapezNZPk\nZXPzKswIhXArxVbltJgOAbL/Os0DBT3hGRJh+iyv4yOnrYUNjFIZ2QxwzaLj3Vu0\nt/3sC/274clgBz/ezTZGtwgn+89J8sKDkWkAWQIDAQABAoIBAQCLI2ll5aAaodzr\n3OCYupvQVMOMdxkxoJsNiH0nBj4YffH94GolY1NrUjWDI7kNtAyd4R+tPLBT5MEc\nlzLynZvwchiCsVTT3jjPDwU/tUQs0wkALrWqyKIYe0chn5bm2Ir8OIB+4e4ROMl7\ncE3fSXSN8eOpetCEujzhP2qYZPGyGsZ0XzAwoWvMi8johnsCqjI+KrWnFmYef/sd\n4kN3Iw7E0dALiTeZgPJoHUmxt50wNwUqsAUM+2pWyLyLBUEwjhLhcod3cFB1A29q\ng4K7uQwZCnYy15PJQd4OD4pDxINqHgcFI2gSOE5kKsdE/S6Nfg7R4pbXAk0KrkTe\nnPT7h2FFAoGBAPft86b3Dm4CvjvsVsFyrMHqeVpPoB9gduoqheqO4VahA36z0glt\nfdh6k2wrE3JWkOlwCAygNvNNqcy+YbimVLw6ArwnMM/8q3twqGbICqCLuMDjnNtT\nH6BUfo4WbVirQqFOQxS+this is replacement texyt/tYabakqx2sMqL/AoGADJrofGCrNySkj19guc0e\nw20sZk8OEQpSgW1QCbDh/AmLp/F0iE4sy8jPnfxCrNmB3Jx5jErJAG2+aE51oXGz\ndS5t3SsQ7EIoZcpAhZk+EROJfSUVYIFFZl1lYcv6Gzv500GrX26d8JmuWCywM3WC\nADC/VmnUGWwpz4FL4OsgwJkCgYEAvxmaXhiGWDZVJQJoudAO0Q9CDb+X8ZHYVr95\nlTAF4Fvts2imz6+9TKj9vMpLRcPvXrAmF/QPkNkq2sfdVq+K3JI/e8z2dHx6zOEx\nMgbyTpG8mYV5C0CBbMkHmvumCnFn1PCDQGqfStkcDK4dy+YaM5Qa5IAxoXHOJXCM\nLwDHBm0CgYEA8GzP15oLQjEIg1A17Drt7Z57YqV+g2xkd3Ay357BI0O1dK32rRYw\nb/GWOZ3CqX9vn+r3r1eIVqYYpduFUf/KEEB2JWVWRrOKQeT3IYUZsooB+4ZA1zMf\nWKY7hSbofWMtB4+qbs1Pb7jmycZVyk+iN3U4/MW8TMc+2fWlphFKujY=\n-----END RSA PRIVATE KEY-----'''\n\njwt_token = jwt.encode({\n  \"iss\": \"3MVG9HxRZv05HarTOzFNw7wcyywI1COaXS4jJ.HdQr9dGEykrPG17sRUtUvEnnapIp5sNioC6i98RnqlanuwW\",\n  \"sub\": \"kalyan.arangam.dev@matillion.com\",\n  \"aud\": \"https://test.salesforce.com\",\n  \"exp\": str(expiry_epoch)\n}, mysecret\n  , algorithm=\"RS256\")\n# print(encoded)\n\n\ncontext.updateVariable('jwt_token', jwt_token)\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"83940":{"id":83940,"sourceID":83941,"targetID":83937},"83942":{"id":83942,"sourceID":83937,"targetID":83938},"83943":{"id":83943,"sourceID":83937,"targetID":83936}},"failureConnectors":{},"unconditionalConnectors":{"83945":{"id":83945,"sourceID":83939,"targetID":83941}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{"83934":{"id":83934,"x":433,"y":-219,"width":418,"height":117,"text":"Note - ignore the \"403 Forbidden\" error. thats bcse the variable holding access_token does not have a proper token until the job is run.","colour":"e6e63c"},"83935":{"id":83935,"x":9,"y":-246,"width":874,"height":236,"text":"**``Load data using Access token (generated from JWTtoken)``**\n\n* Use python to generate JWT Token\n* Use python to get Access token\n* Load data using Access token in Salesforce Query\n* Load data using Access token via python","colour":"00ce4f"}},"variables":{"jwt_token":{"definition":{"name":"jwt_token","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"--some default--"},"sf_access_token":{"definition":{"name":"sf_access_token","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"--access token--"}},"grids":{}},"info":{"name":"salesforceJWT token","description":"","type":"ORCHESTRATION","tag":"b8e1bcb4-41af-4fe1-af4c-ec15ed1adc4f"}}