{"job":{"components":{"1229664":{"id":1229664,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":211954775,"x":2000,"y":160,"width":32,"height":32,"inputConnectorIDs":[1229674],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Append change events"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${target_table}"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"target_metadata"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"column_name"},"2":{"slot":2,"type":"GRID","value":"column_name"}}}},"visible":true},"5":{"slot":5,"name":"Truncate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Append"}}}},"visible":true},"200":{"slot":200,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${target_schema}"}}}},"visible":true},"201":{"slot":201,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${target_database}"}}}},"visible":true},"202":{"slot":202,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${warehouse}"}}}},"visible":true},"203":{"slot":203,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"204":{"slot":204,"name":"Order By","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"MTLN_CDC_SEQUENCE_NUMBER"},"2":{"slot":2,"type":"STRING","value":"Ascending"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"1229665":{"id":1229665,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1701703136,"x":1200,"y":240,"width":32,"height":32,"inputConnectorIDs":[1229675],"outputConnectorIDs":[1229673],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Group by MTLN_CDC_FILENAME"}}}},"visible":true},"2":{"slot":2,"name":"Groupings","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"MTLN_CDC_FILENAME"}}}},"visible":true},"3":{"slot":3,"name":"Aggregations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"MTLN_CDC_FILENAME"},"2":{"slot":2,"type":"STRING","value":"Any Value"}}}},"visible":true},"4":{"slot":4,"name":"Grouping Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Group By"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"1229666":{"id":1229666,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":400,"y":160,"width":32,"height":32,"inputConnectorIDs":[1229676],"outputConnectorIDs":[1229677],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Extract payload and metadata objects"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CASE \"VALUE\":\"metadata\".\"op\"\n    WHEN 'd' THEN \"VALUE\":\"before\"\n    ELSE \"VALUE\":\"after\"\nEND"},"2":{"slot":2,"type":"STRING","value":"PAYLOAD"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"\"VALUE\":\"metadata\""},"2":{"slot":2,"type":"STRING","value":"METADATA"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"\"DATE_HOUR\""},"2":{"slot":2,"type":"STRING","value":"DATE_HOUR"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"\"FILENAME\""},"2":{"slot":2,"type":"STRING","value":"FILENAME"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"\"VERSION\""},"2":{"slot":2,"type":"STRING","value":"VERSION"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"1229667":{"id":1229667,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":1760,"y":160,"width":32,"height":32,"inputConnectorIDs":[1229679],"outputConnectorIDs":[1229674],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Add batch metadata columns"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CAST(${run_history_id} AS INT)"},"2":{"slot":2,"type":"STRING","value":"MTLN_CDC_LOAD_BATCH_ID"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"CURRENT_TIMESTAMP"},"2":{"slot":2,"type":"STRING","value":"MTLN_CDC_LOAD_TIMESTAMP"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"1229668":{"id":1229668,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":560,"y":160,"width":32,"height":32,"inputConnectorIDs":[1229677],"outputConnectorIDs":[1229715],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Extract columns from variant objects"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT \n\t${nested_select_list}\nFROM $T{Extract payload and metadata objects} AS \"EXTRACT PAYLOAD AND METADATA OBJECTS\""}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"1229669":{"id":1229669,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":1360,"y":160,"width":32,"height":32,"inputConnectorIDs":[1229672,1229673],"outputConnectorIDs":[1229678],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Join existing filenames"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Filter on high-water mark"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SOURCE"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Group by MTLN_CDC_FILENAME"},"2":{"slot":2,"type":"STRING","value":"TARGET"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"SOURCE\".\"MTLN_CDC_FILENAME\" = \"TARGET\".\"MTLN_CDC_FILENAME\""},"2":{"slot":2,"type":"STRING","value":"SOURCE_Left_TARGET"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"join_output"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"input_column"},"2":{"slot":2,"type":"GRID","value":"output_column"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"1229670":{"id":1229670,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":1520,"y":160,"width":32,"height":32,"inputConnectorIDs":[1229678],"outputConnectorIDs":[1229679],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Remove files which have already been loaded"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"MTLN_TARGET_MTLN_CDC_FILENAME"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Null"},"4":{"slot":4,"type":"STRING","value":""}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"1229671":{"id":1229671,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":1040,"y":240,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[1229675],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Target table"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${target_table}"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"MTLN_CDC_FILENAME"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${target_schema}"}}}},"visible":true},"6":{"slot":6,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${target_database}"}}}},"visible":true},"7":{"slot":7,"name":"Offset","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"1229692":{"id":1229692,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":160,"y":160,"width":32,"height":32,"inputConnectorIDs":[1229714],"outputConnectorIDs":[1229676],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Filter on source table"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DATABASE"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"${source_database}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"SCHEMA"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"${source_schema}"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"TABLE"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"${source_table}"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"VERSION"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"${source_version}"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"DATE_HOUR"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Greater than or equal to"},"4":{"slot":4,"type":"STRING","value":"${max_date_hour}"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"1229693":{"id":1229693,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":800,"y":160,"width":32,"height":32,"inputConnectorIDs":[1229715],"outputConnectorIDs":[1229672],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Filter on high-water mark"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${high_water_mark_target}"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Greater than or equal to"},"4":{"slot":4,"type":"STRING","value":"${high_water_mark}"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"1229695":{"id":1229695,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":0,"y":160,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[1229714],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Change table"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${stage_table}"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DATABASE"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"SCHEMA"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"TABLE"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"DATE_HOUR"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"FILENAME"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"VALUE"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"VERSION"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${target_schema}"}}}},"visible":true},"6":{"slot":6,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${target_database}"}}}},"visible":true},"7":{"slot":7,"name":"Offset","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"1229672":{"id":1229672,"sourceID":1229693,"targetID":1229669},"1229673":{"id":1229673,"sourceID":1229665,"targetID":1229669},"1229674":{"id":1229674,"sourceID":1229667,"targetID":1229664},"1229675":{"id":1229675,"sourceID":1229671,"targetID":1229665},"1229676":{"id":1229676,"sourceID":1229692,"targetID":1229666},"1229677":{"id":1229677,"sourceID":1229666,"targetID":1229668},"1229678":{"id":1229678,"sourceID":1229669,"targetID":1229670},"1229679":{"id":1229679,"sourceID":1229670,"targetID":1229667},"1229714":{"id":1229714,"sourceID":1229695,"targetID":1229692},"1229715":{"id":1229715,"sourceID":1229668,"targetID":1229693}},"notes":{"1229684":{"id":1229684,"x":-72,"y":87,"width":308,"height":147,"text":"Read data from change table and filter for source table","colour":"e6e63c"},"1229685":{"id":1229685,"x":327,"y":87,"width":308,"height":148,"text":"Extract columns","colour":"e6e63c"},"1229688":{"id":1229688,"x":1687,"y":86,"width":150,"height":150,"text":"Add batch metadata columns","colour":"e6e63c"},"1229689":{"id":1229689,"x":-73,"y":-154,"width":547,"height":149,"text":"**Transformation type = change log**\n\nExtract latest change events for source table, and append them all to the target table as a change log","colour":"00ce4f"},"1229690":{"id":1229690,"x":727,"y":-154,"width":148,"height":389,"text":"Apply filter on high-water mark to get latest changes\n\nNote, we apply \">=\" here, rather than \">\".  Large updates to the source table may be split across multiple files, with the same high-water mark, and some of these files may be processed by separate job executions.\n\nThe consequence is that we may include some data here which has already been processed.","colour":"e6e63c"},"1229691":{"id":1229691,"x":1928,"y":86,"width":150,"height":149,"text":"Append new change events to target table","colour":"e6e63c"},"1229694":{"id":1229694,"x":967,"y":87,"width":630,"height":226,"text":"Remove any change events for files we have already processed","colour":"e6e63c"}},"noteConnectors":{},"variables":{"high_water_mark":{"definition":{"name":"high_water_mark","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"high_water_mark_target":{"definition":{"name":"high_water_mark_target","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"max_date_hour":{"definition":{"name":"max_date_hour","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"nested_select_list":{"definition":{"name":"nested_select_list","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"source_database":{"definition":{"name":"source_database","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"source_schema":{"definition":{"name":"source_schema","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"source_table":{"definition":{"name":"source_table","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"source_version":{"definition":{"name":"source_version","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"stage_table":{"definition":{"name":"stage_table","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"target_database":{"definition":{"name":"target_database","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"target_schema":{"definition":{"name":"target_schema","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"target_table":{"definition":{"name":"target_table","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"warehouse":{"definition":{"name":"warehouse","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null}},"grids":{"join_output":{"definition":{"name":"join_output","scope":"TASKBATCH","definitions":[{"name":"input_column","type":"TEXT"},{"name":"output_column","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[]},"target_metadata":{"definition":{"name":"target_metadata","scope":"TASKBATCH","definitions":[{"name":"column_name","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[]}}},"info":{"name":"Sync Single Table - 1-2-4-1 - Transform and append","description":"Unpacked from Shared Job [Sync Single Table].","type":"TRANSFORMATION","tag":"dcb08d92-7b89-4059-98bd-c20c5d172606"}}