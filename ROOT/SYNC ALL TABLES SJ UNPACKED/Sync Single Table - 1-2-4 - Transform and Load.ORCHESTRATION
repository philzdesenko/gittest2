{"job":{"components":{"1235944":{"id":1235944,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-369209785,"x":-400,"y":640,"width":32,"height":32,"inputConnectorIDs":[1235980],"outputSuccessConnectorIDs":[1235971],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Append full CDC metadata to nested_metadata"}}}},"visible":true},"2":{"slot":2,"name":"Target Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"nested_metadata"}}}},"visible":true},"3":{"slot":3,"name":"Fixed/Grid","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Fixed"}}}},"visible":true},"4":{"slot":4,"name":"Values Grid","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"METADATA"},"2":{"slot":2,"type":"STRING","value":"db"},"3":{"slot":3,"type":"STRING","value":"MTLN_CDC_SRC_DATABASE"},"4":{"slot":4,"type":"STRING","value":"VARCHAR"},"5":{"slot":5,"type":"STRING","value":"16777216"},"6":{"slot":6,"type":"STRING","value":"0"},"7":{"slot":7,"type":"STRING","value":"VARCHAR(16777216)"},"8":{"slot":8,"type":"STRING","value":null},"9":{"slot":9,"type":"STRING","value":"No"},"10":{"slot":10,"type":"STRING","value":"No"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"METADATA"},"2":{"slot":2,"type":"STRING","value":"schema"},"3":{"slot":3,"type":"STRING","value":"MTLN_CDC_SRC_SCHEMA"},"4":{"slot":4,"type":"STRING","value":"VARCHAR"},"5":{"slot":5,"type":"STRING","value":"16777216"},"6":{"slot":6,"type":"STRING","value":"0"},"7":{"slot":7,"type":"STRING","value":"VARCHAR(16777216)"},"8":{"slot":8,"type":"STRING","value":null},"9":{"slot":9,"type":"STRING","value":"No"},"10":{"slot":10,"type":"STRING","value":"No"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"METADATA"},"2":{"slot":2,"type":"STRING","value":"table"},"3":{"slot":3,"type":"STRING","value":"MTLN_CDC_SRC_TABLE"},"4":{"slot":4,"type":"STRING","value":"VARCHAR"},"5":{"slot":5,"type":"STRING","value":"16777216"},"6":{"slot":6,"type":"STRING","value":"0"},"7":{"slot":7,"type":"STRING","value":"VARCHAR(16777216)"},"8":{"slot":8,"type":"STRING","value":null},"9":{"slot":9,"type":"STRING","value":"No"},"10":{"slot":10,"type":"STRING","value":"No"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"METADATA"},"2":{"slot":2,"type":"STRING","value":"op"},"3":{"slot":3,"type":"STRING","value":"MTLN_CDC_LAST_CHANGE_TYPE"},"4":{"slot":4,"type":"STRING","value":"VARCHAR"},"5":{"slot":5,"type":"STRING","value":"16777216"},"6":{"slot":6,"type":"STRING","value":"0"},"7":{"slot":7,"type":"STRING","value":"VARCHAR(16777216)"},"8":{"slot":8,"type":"STRING","value":null},"9":{"slot":9,"type":"STRING","value":"No"},"10":{"slot":10,"type":"STRING","value":"No"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"METADATA"},"2":{"slot":2,"type":"STRING","value":"ts_ms"},"3":{"slot":3,"type":"STRING","value":"MTLN_CDC_LAST_COMMIT_TIMESTAMP"},"4":{"slot":4,"type":"STRING","value":"NUMBER"},"5":{"slot":5,"type":"STRING","value":"38"},"6":{"slot":6,"type":"STRING","value":"0"},"7":{"slot":7,"type":"STRING","value":"NUMBER(38, 0)"},"8":{"slot":8,"type":"STRING","value":null},"9":{"slot":9,"type":"STRING","value":"No"},"10":{"slot":10,"type":"STRING","value":"No"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"VERSION"},"2":{"slot":2,"type":"STRING","value":""},"3":{"slot":3,"type":"STRING","value":"MTLN_CDC_SRC_VERSION"},"4":{"slot":4,"type":"STRING","value":"NUMBER"},"5":{"slot":5,"type":"STRING","value":"38"},"6":{"slot":6,"type":"STRING","value":"0"},"7":{"slot":7,"type":"STRING","value":"NUMBER(38, 0)"},"8":{"slot":8,"type":"STRING","value":null},"9":{"slot":9,"type":"STRING","value":"No"},"10":{"slot":10,"type":"STRING","value":"No"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"DATE_HOUR"},"2":{"slot":2,"type":"STRING","value":""},"3":{"slot":3,"type":"STRING","value":"MTLN_CDC_PROCESSED_DATE_HOUR"},"4":{"slot":4,"type":"STRING","value":"TIMESTAMP"},"5":{"slot":5,"type":"STRING","value":"9"},"6":{"slot":6,"type":"STRING","value":"0"},"7":{"slot":7,"type":"STRING","value":"TIMESTAMP"},"8":{"slot":8,"type":"STRING","value":null},"9":{"slot":9,"type":"STRING","value":"No"},"10":{"slot":10,"type":"STRING","value":"No"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"FILENAME"},"2":{"slot":2,"type":"STRING","value":""},"3":{"slot":3,"type":"STRING","value":"MTLN_CDC_FILENAME"},"4":{"slot":4,"type":"STRING","value":"VARCHAR"},"5":{"slot":5,"type":"STRING","value":"16777216"},"6":{"slot":6,"type":"STRING","value":"0"},"7":{"slot":7,"type":"STRING","value":"VARCHAR(16777216)"},"8":{"slot":8,"type":"STRING","value":null},"9":{"slot":9,"type":"STRING","value":"No"},"10":{"slot":10,"type":"STRING","value":"No"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"METADATA"},"2":{"slot":2,"type":"STRING","value":"${commit_id_name}"},"3":{"slot":3,"type":"STRING","value":"MTLN_CDC_SEQUENCE_NUMBER"},"4":{"slot":4,"type":"STRING","value":"${commit_id_datatype}"},"5":{"slot":5,"type":"STRING","value":"${commit_id_precision}"},"6":{"slot":6,"type":"STRING","value":"${commit_id_scale}"},"7":{"slot":7,"type":"STRING","value":"${commit_id_database_type}"},"8":{"slot":8,"type":"STRING","value":null},"9":{"slot":9,"type":"STRING","value":"No"},"10":{"slot":10,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Source Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"6":{"slot":6,"name":"Column Mapping","elements":{},"visible":false},"7":{"slot":7,"name":"Append/Prepend","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Append"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1235945":{"id":1235945,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":1280,"y":1360,"width":32,"height":32,"inputConnectorIDs":[1235981],"outputSuccessConnectorIDs":[1235996],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Transform and load without deletes"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sync Single Table - 1-2-4-3 - Transform and load without deletes"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"source_database"},"2":{"slot":2,"type":"STRING","value":"${source_database}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"source_schema"},"2":{"slot":2,"type":"STRING","value":"${source_schema}"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"source_table"},"2":{"slot":2,"type":"STRING","value":"${source_table}"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"source_version"},"2":{"slot":2,"type":"STRING","value":"${source_version}"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"warehouse"},"2":{"slot":2,"type":"STRING","value":"${warehouse}"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"target_database"},"2":{"slot":2,"type":"STRING","value":"${target_database}"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"target_schema"},"2":{"slot":2,"type":"STRING","value":"${target_schema}"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"stage_table"},"2":{"slot":2,"type":"STRING","value":"${stage_table}"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"target_table"},"2":{"slot":2,"type":"STRING","value":"${target_table}"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"max_date_hour"},"2":{"slot":2,"type":"STRING","value":"${max_date_hour}"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"high_water_mark"},"2":{"slot":2,"type":"STRING","value":"${high_water_mark}"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"high_water_mark_target"},"2":{"slot":2,"type":"STRING","value":"${high_water_mark_target}"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"join_expression"},"2":{"slot":2,"type":"STRING","value":"${join_expression}"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"nested_select_list"},"2":{"slot":2,"type":"STRING","value":"${nested_select_list}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{"1":{"slot":1,"elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"join_output"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"input_column"},"2":{"slot":2,"type":"GRID","value":"output_column"}}}},"values":{"1":{"slot":1,"type":"STRING","value":"join_output"},"2":{"slot":2,"type":"STRING","value":"grid"}}},"2":{"slot":2,"elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"primary_key"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"key_column"}}}},"values":{"1":{"slot":1,"type":"STRING","value":"primary_key"},"2":{"slot":2,"type":"STRING","value":"grid"}}},"3":{"slot":3,"elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"target_metadata"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"column_name"}}}},"values":{"1":{"slot":1,"type":"STRING","value":"target_metadata"},"2":{"slot":2,"type":"STRING","value":"grid"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1235947":{"id":1235947,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":400,"y":960,"width":32,"height":32,"inputConnectorIDs":[1235983],"outputSuccessConnectorIDs":[1235970],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Build join_output grid var for Copy Table"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"target_metadata = context.getGridVariable('target_metadata') or []\nprimary_key = context.getGridVariable('primary_key') or []\njoin_output = []\n\n# if we aren't adding full metadata, target_metadata may not contain MTLN_CDC_LAST_CHANGE_TYPE\n# we need this column in the join_output, so append it now\ntarget_columns = [column for column, *_ in target_metadata]\nif 'MTLN_CDC_LAST_CHANGE_TYPE' not in target_columns:\n    target_columns.append('MTLN_CDC_LAST_CHANGE_TYPE')\n\n# add target columns into join_output\nfor column in target_columns:\n    \n    # ignore these metadata columns as they are added to transformation after the join\n    if column in ('MTLN_CDC_LOAD_BATCH_ID', 'MTLN_CDC_LOAD_TIMESTAMP', 'MTLN_CDC_DELETED'):\n        continue\n        \n    # add these columns as SOURCE columns\n    join_output.append([f'SOURCE.{column}', column])\n\n# add one column from primary key in target table into join_output\nfor column in primary_key:\n    join_output.append([f'TARGET.{column[0]}', 'MTLN_TARGET_KEY'])\n    break\n\n# add current sequence number from target table\njoin_output.append(['TARGET.MTLN_CDC_SEQUENCE_NUMBER', 'MTLN_TARGET_MTLN_CDC_SEQUENCE_NUMBER'])\n\nprint('join_output:')\nfor x in join_output:\n    print('\\t'.join(map(str,x)))\ncontext.updateGridVariable('join_output', join_output)\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1235948":{"id":1235948,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":720,"y":640,"width":32,"height":32,"inputConnectorIDs":[1235975],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success - Changes appended"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1235949":{"id":1235949,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-369209785,"x":880,"y":1280,"width":32,"height":32,"inputConnectorIDs":[1235976],"outputSuccessConnectorIDs":[1235999],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Append full CDC metadata to delete_mapping"}}}},"visible":true},"2":{"slot":2,"name":"Target Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"delete_mapping"}}}},"visible":true},"3":{"slot":3,"name":"Fixed/Grid","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Fixed"}}}},"visible":true},"4":{"slot":4,"name":"Values Grid","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"MTLN_CDC_SRC_VERSION"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"MTLN_CDC_LAST_CHANGE_TYPE"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"MTLN_CDC_LAST_COMMIT_TIMESTAMP"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"MTLN_CDC_PROCESSED_DATE_HOUR"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"MTLN_CDC_SEQUENCE_NUMBER"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"MTLN_CDC_LOAD_BATCH_ID"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"MTLN_CDC_LOAD_TIMESTAMP"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"MTLN_CDC_DELETED"}}}},"visible":true},"5":{"slot":5,"name":"Source Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"6":{"slot":6,"name":"Column Mapping","elements":{},"visible":false},"7":{"slot":7,"name":"Append/Prepend","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Append"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1235950":{"id":1235950,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"CONDITIONAL","executionHint":"FLOW","implementationID":-1357378929,"x":720,"y":1360,"width":32,"height":32,"inputConnectorIDs":[1235977],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[1235976],"outputFalseConnectorIDs":[1235982],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Append full CDC metadata to target_metadata?"}}}},"visible":true},"2":{"slot":2,"name":"Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Advanced"}}}},"visible":true},"3":{"slot":3,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"append_metadata"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"Y"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"append_metadata"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"y"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"append_metadata"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"Yes"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"append_metadata"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"YES"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"append_metadata"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"yes"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"append_metadata"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"True"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"append_metadata"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"true"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"append_metadata"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"TRUE"}}}},"visible":false},"4":{"slot":4,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or"}}}},"visible":false},"5":{"slot":5,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"['yes', 'y', 'true', 't', '1'].indexOf(append_metadata.toLowerCase()) !== -1"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1235984":{"id":1235984,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":-5,"y":637,"width":32,"height":32,"inputConnectorIDs":[1235969],"outputSuccessConnectorIDs":[1235972],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Build nested_select_list"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"def combine_column_name(column_name, property_name):\n    \"\"\"\n    Combine the column name with an optional property name\n    \"\"\"\n    if property_name:\n        return f'\"{column_name}\":\"{property_name}\"'\n    else:\n        return f'\"{column_name}\"'\n\n\nnested_metadata = context.getGridVariable('nested_metadata') or []\ntable_alias ='EXTRACT PAYLOAD AND METADATA OBJECTS'\n\nnested_list = [] \n\n# In SQL Server, the change_lsn is null for the initial snapshot, so coalesce with commit_lsn\nif connector == 'sqlserver':\n    for column, prop, alias, _, _, _, database_type, *_ in nested_metadata:\n        if prop == commit_id_name:\n            nested_list.append('COALESCE('\n                                   f'\"{table_alias}\".{combine_column_name(column, prop)}::{database_type},'\n                                   f'\"{table_alias}\".{combine_column_name(column, \"commit_lsn\")}::{database_type}'\n                               f') AS \"{alias}\"')\n        else:\n            nested_list.append(f'\"{table_alias}\".{combine_column_name(column, prop)}::{database_type} AS \"{alias}\"')\nelse:\n    # create a list of entries like \"table.col.prop AS alias\", then join as single string\n    nested_list = [f'\"{table_alias}\".{combine_column_name(column, prop)}::{database_type} AS \"{alias}\"' \n                   for column, prop, alias, _, _, _, database_type, *_ in nested_metadata]\n\nnested_select_list = ',\\n\\t'.join(nested_list)\n\nprint(f'nested_select_list: \\n{nested_select_list}')\ncontext.updateVariable('nested_select_list', nested_select_list)\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1235985":{"id":1235985,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-369209785,"x":880,"y":1440,"width":32,"height":32,"inputConnectorIDs":[1235982],"outputSuccessConnectorIDs":[1235974],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Append minimal CDC metadata to delete_mapping"}}}},"visible":true},"2":{"slot":2,"name":"Target Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"delete_mapping"}}}},"visible":true},"3":{"slot":3,"name":"Fixed/Grid","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Fixed"}}}},"visible":true},"4":{"slot":4,"name":"Values Grid","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"MTLN_CDC_SRC_VERSION"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"MTLN_CDC_PROCESSED_DATE_HOUR"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"MTLN_CDC_SEQUENCE_NUMBER"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"MTLN_CDC_DELETED"}}}},"visible":true},"5":{"slot":5,"name":"Source Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"6":{"slot":6,"name":"Column Mapping","elements":{},"visible":false},"7":{"slot":7,"name":"Append/Prepend","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Append"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1235986":{"id":1235986,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":1040,"y":1360,"width":32,"height":32,"inputConnectorIDs":[1235974,1235999],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[1235981],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Join paths"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1235987":{"id":1235987,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":560,"y":640,"width":32,"height":32,"inputConnectorIDs":[1235968],"outputSuccessConnectorIDs":[1235975],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Transform and append"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sync Single Table - 1-2-4-1 - Transform and append"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"source_database"},"2":{"slot":2,"type":"STRING","value":"${source_database}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"source_schema"},"2":{"slot":2,"type":"STRING","value":"${source_schema}"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"source_table"},"2":{"slot":2,"type":"STRING","value":"${source_table}"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"source_version"},"2":{"slot":2,"type":"STRING","value":"${source_version}"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"warehouse"},"2":{"slot":2,"type":"STRING","value":"${warehouse}"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"target_database"},"2":{"slot":2,"type":"STRING","value":"${target_database}"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"target_schema"},"2":{"slot":2,"type":"STRING","value":"${target_schema}"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"stage_table"},"2":{"slot":2,"type":"STRING","value":"${stage_table}"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"target_table"},"2":{"slot":2,"type":"STRING","value":"${target_table}"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"max_date_hour"},"2":{"slot":2,"type":"STRING","value":"${max_date_hour}"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"high_water_mark"},"2":{"slot":2,"type":"STRING","value":"${high_water_mark}"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"high_water_mark_target"},"2":{"slot":2,"type":"STRING","value":"${high_water_mark_target}"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"nested_select_list"},"2":{"slot":2,"type":"STRING","value":"${nested_select_list}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{"1":{"slot":1,"elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"join_output"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"input_column"},"2":{"slot":2,"type":"GRID","value":"output_column"}}}},"values":{"1":{"slot":1,"type":"STRING","value":"join_output"},"2":{"slot":2,"type":"STRING","value":"grid"}}},"2":{"slot":2,"elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"target_metadata"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"column_name"}}}},"values":{"1":{"slot":1,"type":"STRING","value":"target_metadata"},"2":{"slot":2,"type":"STRING","value":"grid"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1235988":{"id":1235988,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-240,"y":640,"width":32,"height":32,"inputConnectorIDs":[1235971],"outputSuccessConnectorIDs":[1235969],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Print nested_metadata"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"nested_metadata = context.getGridVariable('nested_metadata') or []\nprint('nested_metadata:')\nfor x in nested_metadata:\n    print('\\t'.join(map(str,x)))\n\nprint()\ntarget_metadata = context.getGridVariable('target_metadata') or []\nprint('target_metadata:')\nfor x in target_metadata:\n    print('\\t'.join(map(str,x)))\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1235989":{"id":1235989,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-560,"y":640,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[1235980],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1235990":{"id":1235990,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":400,"y":640,"width":32,"height":32,"inputConnectorIDs":[1235979],"outputSuccessConnectorIDs":[1235968],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Build join_output grid var for Change Log"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"from pprint import pprint\n\ntarget_metadata = context.getGridVariable('target_metadata') or []\njoin_output = []\n\ntarget_columns = [column for column, *_ in target_metadata]\n\n# add target columns into join_output\nfor column in target_columns:\n    \n    # ignore these metadata columns as they are added to transformation after the join\n    if column in ('MTLN_CDC_LOAD_BATCH_ID', 'MTLN_CDC_LOAD_TIMESTAMP'):\n        continue\n        \n    # add these columns as SOURCE columns\n    join_output.append([f'SOURCE.{column}', column])\n\n# add MTLN_CDC_FILENAME in target table into join_output\njoin_output.append([f'TARGET.MTLN_CDC_FILENAME', 'MTLN_TARGET_MTLN_CDC_FILENAME'])\n\nprint('join_output:')\nfor x in join_output:\n  print(\"\\t\".join(map(str,x)))\ncontext.updateGridVariable('join_output', join_output)\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1235991":{"id":1235991,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":960,"y":960,"width":32,"height":32,"inputConnectorIDs":[1235997],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success - Changes applied"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1235992":{"id":1235992,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"CONDITIONAL","executionHint":"FLOW","implementationID":-1357378929,"x":240,"y":640,"width":32,"height":32,"inputConnectorIDs":[1235972],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[1235979],"outputFalseConnectorIDs":[1235983],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Transformation is Change Log?"}}}},"visible":true},"2":{"slot":2,"name":"Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Simple"}}}},"visible":true},"3":{"slot":3,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"transformation_type"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"change log"}}}},"visible":true},"4":{"slot":4,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or"}}}},"visible":true},"5":{"slot":5,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1235993":{"id":1235993,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"CONDITIONAL","executionHint":"FLOW","implementationID":-1357378929,"x":640,"y":960,"width":32,"height":32,"inputConnectorIDs":[1235970],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[1235978],"outputFalseConnectorIDs":[1235977],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Transformation is Copy Table?"}}}},"visible":true},"2":{"slot":2,"name":"Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Simple"}}}},"visible":true},"3":{"slot":3,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"transformation_type"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"copy table"}}}},"visible":true},"4":{"slot":4,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or"}}}},"visible":true},"5":{"slot":5,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"['yes', 'y', 'true', 't', '1'].indexOf(soft_deletes.toLowerCase()) !== -1"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1235994":{"id":1235994,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":800,"y":960,"width":32,"height":32,"inputConnectorIDs":[1235978],"outputSuccessConnectorIDs":[1235997],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Transform and load"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sync Single Table - 1-2-4-2 - Transform and load"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"source_database"},"2":{"slot":2,"type":"STRING","value":"${source_database}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"source_schema"},"2":{"slot":2,"type":"STRING","value":"${source_schema}"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"source_table"},"2":{"slot":2,"type":"STRING","value":"${source_table}"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"source_version"},"2":{"slot":2,"type":"STRING","value":"${source_version}"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"warehouse"},"2":{"slot":2,"type":"STRING","value":"${warehouse}"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"target_database"},"2":{"slot":2,"type":"STRING","value":"${target_database}"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"target_schema"},"2":{"slot":2,"type":"STRING","value":"${target_schema}"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"stage_table"},"2":{"slot":2,"type":"STRING","value":"${stage_table}"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"target_table"},"2":{"slot":2,"type":"STRING","value":"${target_table}"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"max_date_hour"},"2":{"slot":2,"type":"STRING","value":"${max_date_hour}"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"high_water_mark"},"2":{"slot":2,"type":"STRING","value":"${high_water_mark}"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"high_water_mark_target"},"2":{"slot":2,"type":"STRING","value":"${high_water_mark_target}"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"join_expression"},"2":{"slot":2,"type":"STRING","value":"${join_expression}"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"nested_select_list"},"2":{"slot":2,"type":"STRING","value":"${nested_select_list}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{"1":{"slot":1,"elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"join_output"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"input_column"},"2":{"slot":2,"type":"GRID","value":"output_column"}}}},"values":{"1":{"slot":1,"type":"STRING","value":"join_output"},"2":{"slot":2,"type":"STRING","value":"grid"}}},"2":{"slot":2,"elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"primary_key"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"key_column"}}}},"values":{"1":{"slot":1,"type":"STRING","value":"primary_key"},"2":{"slot":2,"type":"STRING","value":"grid"}}},"3":{"slot":3,"elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"target_metadata"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"column_name"}}}},"values":{"1":{"slot":1,"type":"STRING","value":"target_metadata"},"2":{"slot":2,"type":"STRING","value":"grid"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1235995":{"id":1235995,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":1600,"y":1360,"width":32,"height":32,"inputConnectorIDs":[1235973],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success - Changes applied with soft deletes"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1235998":{"id":1235998,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":1440,"y":1360,"width":32,"height":32,"inputConnectorIDs":[1235996],"outputSuccessConnectorIDs":[1235973],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Transform and load soft deletes"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sync Single Table - 1-2-4-4 - Transform and load soft deletes"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"source_database"},"2":{"slot":2,"type":"STRING","value":"${source_database}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"source_schema"},"2":{"slot":2,"type":"STRING","value":"${source_schema}"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"source_table"},"2":{"slot":2,"type":"STRING","value":"${source_table}"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"source_version"},"2":{"slot":2,"type":"STRING","value":"${source_version}"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"warehouse"},"2":{"slot":2,"type":"STRING","value":"${warehouse}"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"target_database"},"2":{"slot":2,"type":"STRING","value":"${target_database}"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"target_schema"},"2":{"slot":2,"type":"STRING","value":"${target_schema}"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"stage_table"},"2":{"slot":2,"type":"STRING","value":"${stage_table}"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"target_table"},"2":{"slot":2,"type":"STRING","value":"${target_table}"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"max_date_hour"},"2":{"slot":2,"type":"STRING","value":"${max_date_hour}"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"high_water_mark"},"2":{"slot":2,"type":"STRING","value":"${high_water_mark}"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"high_water_mark_target"},"2":{"slot":2,"type":"STRING","value":"${high_water_mark_target}"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"join_expression"},"2":{"slot":2,"type":"STRING","value":"${join_expression}"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"nested_select_list"},"2":{"slot":2,"type":"STRING","value":"${nested_select_list}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{"1":{"slot":1,"elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"delete_mapping"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"column_name"}}}},"values":{"1":{"slot":1,"type":"STRING","value":"delete_mapping"},"2":{"slot":2,"type":"STRING","value":"grid"}}},"2":{"slot":2,"elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"join_output"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"input_column"},"2":{"slot":2,"type":"GRID","value":"output_column"}}}},"values":{"1":{"slot":1,"type":"STRING","value":"join_output"},"2":{"slot":2,"type":"STRING","value":"grid"}}},"3":{"slot":3,"elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"primary_key"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"key_column"}}}},"values":{"1":{"slot":1,"type":"STRING","value":"primary_key"},"2":{"slot":2,"type":"STRING","value":"grid"}}},"4":{"slot":4,"elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"target_metadata"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"column_name"}}}},"values":{"1":{"slot":1,"type":"STRING","value":"target_metadata"},"2":{"slot":2,"type":"STRING","value":"grid"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"1235968":{"id":1235968,"sourceID":1235990,"targetID":1235987},"1235969":{"id":1235969,"sourceID":1235988,"targetID":1235984},"1235970":{"id":1235970,"sourceID":1235947,"targetID":1235993},"1235971":{"id":1235971,"sourceID":1235944,"targetID":1235988},"1235972":{"id":1235972,"sourceID":1235984,"targetID":1235992},"1235973":{"id":1235973,"sourceID":1235998,"targetID":1235995},"1235974":{"id":1235974,"sourceID":1235985,"targetID":1235986},"1235975":{"id":1235975,"sourceID":1235987,"targetID":1235948},"1235996":{"id":1235996,"sourceID":1235945,"targetID":1235998},"1235997":{"id":1235997,"sourceID":1235994,"targetID":1235991},"1235999":{"id":1235999,"sourceID":1235949,"targetID":1235986}},"failureConnectors":{},"unconditionalConnectors":{"1235980":{"id":1235980,"sourceID":1235989,"targetID":1235944},"1235981":{"id":1235981,"sourceID":1235986,"targetID":1235945}},"trueConnectors":{"1235976":{"id":1235976,"sourceID":1235950,"targetID":1235949},"1235978":{"id":1235978,"sourceID":1235993,"targetID":1235994},"1235979":{"id":1235979,"sourceID":1235992,"targetID":1235990}},"falseConnectors":{"1235977":{"id":1235977,"sourceID":1235993,"targetID":1235950},"1235982":{"id":1235982,"sourceID":1235950,"targetID":1235985},"1235983":{"id":1235983,"sourceID":1235992,"targetID":1235947}},"iterationConnectors":{},"noteConnectors":{},"notes":{"1235936":{"id":1235936,"x":166,"y":485,"width":468,"height":231,"text":"**Transform and append change events**\n\nAppend latest change events to target table as change log\n\nIn the transformation job, we perform a left join onto the target table.  Specify the output columns with the __join_output__grid variable.","colour":"e6e63c"},"1235937":{"id":1235937,"x":326,"y":806,"width":151,"height":229,"text":"**Build join_output grid var for Copy Table**\n\nIn the transformation jobs, we perform a left join onto the target table.  Specify the output columns with the __join_output__grid variable.","colour":"e6e63c"},"1235940":{"id":1235940,"x":-475,"y":486,"width":308,"height":229,"text":"**Add CDC metadata to nested_metadata**\n\nAdd all the CDC metadata columns to the __nested_metadata__grid variable.  This will be used in the transformation job to flatten the variant objects to columns.\n\nAny columns not required in the target table will be ignored by the Table Update components.","colour":"e6e63c"},"1235941":{"id":1235941,"x":-74,"y":486,"width":147,"height":228,"text":"**Build nested_select_list**\n\nIn the transformation job, we need to use a SQL component to extract nested data.  This script builds the column list for the SELECT clause.","colour":"e6e63c"},"1235942":{"id":1235942,"x":646,"y":1127,"width":468,"height":388,"text":"**Build delete_mapping**\n\nFor soft deletes, a __delete_mapping__grid variable is passed into the transformation job.  This contains the columns which are to be updated when marking a record as deleted.","colour":"e6e63c"},"1235943":{"id":1235943,"x":1206,"y":1126,"width":308,"height":308,"text":"**Transform and load with soft deletes**\n\nApply latest CDC data to target table, updating MTLN_CDC_DELETED where records have been deleted from source.\n\nNote:  The payload for a delete event does not contain an __after__object, and the __before__object only contains the primary key.  If the current batch of change events contains an insert or update for a source record, as well as a delete, we must process that insert or update first.  After processing the delete event, and marking the target record as deleted, the other columns in the target record should reflect the final value of the source record.","colour":"e6e63c"},"1235946":{"id":1235946,"x":564,"y":806,"width":310,"height":229,"text":"**Transform and load without soft deletes**\n\nApply latest CDC data to target table, deleting records which have been deleted from source","colour":"e6e63c"}},"variables":{"append_metadata":{"definition":{"name":"append_metadata","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"commit_id_database_type":{"definition":{"name":"commit_id_database_type","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"commit_id_datatype":{"definition":{"name":"commit_id_datatype","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"commit_id_name":{"definition":{"name":"commit_id_name","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"commit_id_precision":{"definition":{"name":"commit_id_precision","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"commit_id_scale":{"definition":{"name":"commit_id_scale","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"connector":{"definition":{"name":"connector","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"high_water_mark":{"definition":{"name":"high_water_mark","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"high_water_mark_target":{"definition":{"name":"high_water_mark_target","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"join_expression":{"definition":{"name":"join_expression","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"max_date_hour":{"definition":{"name":"max_date_hour","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"nested_select_list":{"definition":{"name":"nested_select_list","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PRIVATE"},"value":""},"source_database":{"definition":{"name":"source_database","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"source_schema":{"definition":{"name":"source_schema","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"source_table":{"definition":{"name":"source_table","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"source_version":{"definition":{"name":"source_version","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"stage_table":{"definition":{"name":"stage_table","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"target_database":{"definition":{"name":"target_database","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"target_schema":{"definition":{"name":"target_schema","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"target_table":{"definition":{"name":"target_table","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"transformation_type":{"definition":{"name":"transformation_type","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"warehouse":{"definition":{"name":"warehouse","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null}},"grids":{"delete_mapping":{"definition":{"name":"delete_mapping","scope":"TASKBATCH","definitions":[{"name":"column_name","type":"TEXT"}],"description":"","visibility":"PRIVATE"},"values":[]},"join_output":{"definition":{"name":"join_output","scope":"TASKBATCH","definitions":[{"name":"input_column","type":"TEXT"},{"name":"output_column","type":"TEXT"}],"description":"","visibility":"PRIVATE"},"values":[]},"nested_metadata":{"definition":{"name":"nested_metadata","scope":"TASKBATCH","definitions":[{"name":"column_name","type":"TEXT"},{"name":"property","type":"TEXT"},{"name":"alias","type":"TEXT"},{"name":"type","type":"TEXT"},{"name":"size","type":"DECIMAL"},{"name":"precision","type":"DECIMAL"},{"name":"database_type","type":"TEXT"},{"name":"default_value","type":"TEXT"},{"name":"not_null","type":"TEXT"},{"name":"unique","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[]},"primary_key":{"definition":{"name":"primary_key","scope":"TASKBATCH","definitions":[{"name":"key_column","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[]},"target_metadata":{"definition":{"name":"target_metadata","scope":"TASKBATCH","definitions":[{"name":"column_name","type":"TEXT"},{"name":"type","type":"TEXT"},{"name":"size","type":"DECIMAL"},{"name":"precision","type":"DECIMAL"},{"name":"database_type","type":"TEXT"},{"name":"default_value","type":"TEXT"},{"name":"not_null","type":"TEXT"},{"name":"unique","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[]}}},"info":{"name":"Sync Single Table - 1-2-4 - Transform and Load","description":"Unpacked from Shared Job [Sync Single Table].","type":"ORCHESTRATION","tag":"5851813b-fc0a-4cda-b3c8-8bdeb924cdc1"}}