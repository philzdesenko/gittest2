{"job":{"components":{"1229304":{"id":1229304,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":-960,"y":0,"width":32,"height":32,"inputConnectorIDs":[1229366],"outputSuccessConnectorIDs":[1229363],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update [Environment Default] values"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"if target_database == '[Environment Default]':\n    print(f'Updating target_database from [Environment Default] to: {environment_database}')\n    context.updateVariable('target_database', environment_database)\n\nif target_schema == '[Environment Default]':\n    print(f'Updating target_schema from [Environment Default] to: {environment_default_schema}')\n    context.updateVariable('target_schema', environment_default_schema)\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1229305":{"id":1229305,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-480,"y":0,"width":32,"height":32,"inputConnectorIDs":[1229362],"outputSuccessConnectorIDs":[1229360],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create or refresh external table"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create or Refresh External Table - 1-1 - Create or refresh"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"cloud_storage_url"},"2":{"slot":2,"type":"STRING","value":"${cloud_storage_url}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"target_database"},"2":{"slot":2,"type":"STRING","value":"${target_database}"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"target_schema"},"2":{"slot":2,"type":"STRING","value":"${target_schema}"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"snowflake_stage"},"2":{"slot":2,"type":"STRING","value":"${snowflake_stage}"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"external_table"},"2":{"slot":2,"type":"STRING","value":"${external_table}"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"file_type"},"2":{"slot":2,"type":"STRING","value":"AVRO"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{"1":{"slot":1,"elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DATABASE"},"2":{"slot":2,"type":"STRING","value":"VARCHAR"},"3":{"slot":3,"type":"STRING","value":""},"4":{"slot":4,"type":"STRING","value":""},"5":{"slot":5,"type":"STRING","value":"SPLIT_PART(SPLIT_PART(\"METADATA$FILENAME\", '/',  -9), '=', -1)"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"SCHEMA"},"2":{"slot":2,"type":"STRING","value":"VARCHAR"},"3":{"slot":3,"type":"STRING","value":""},"4":{"slot":4,"type":"STRING","value":""},"5":{"slot":5,"type":"STRING","value":"SPLIT_PART(SPLIT_PART(\"METADATA$FILENAME\", '/',  -8), '=', -1)"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"TABLE"},"2":{"slot":2,"type":"STRING","value":"VARCHAR"},"3":{"slot":3,"type":"STRING","value":""},"4":{"slot":4,"type":"STRING","value":""},"5":{"slot":5,"type":"STRING","value":"SPLIT_PART(SPLIT_PART(\"METADATA$FILENAME\", '/',  -7), '=', -1)"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"VERSION"},"2":{"slot":2,"type":"STRING","value":"NUMBER"},"3":{"slot":3,"type":"STRING","value":""},"4":{"slot":4,"type":"STRING","value":""},"5":{"slot":5,"type":"STRING","value":"CAST(SPLIT_PART(SPLIT_PART(\"METADATA$FILENAME\", '/',  -6), '=', -1) AS NUMBER(38, 0))"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"DATE_HOUR"},"2":{"slot":2,"type":"STRING","value":"TIMESTAMP"},"3":{"slot":3,"type":"STRING","value":""},"4":{"slot":4,"type":"STRING","value":""},"5":{"slot":5,"type":"STRING","value":"TO_TIMESTAMP(SPLIT_PART(SPLIT_PART(\"METADATA$FILENAME\", '/',  -5), '=', -1) || SPLIT_PART(SPLIT_PART(\"METADATA$FILENAME\", '/',  -4), '=', -1) || SPLIT_PART(SPLIT_PART(\"METADATA$FILENAME\", '/',  -3), '=', -1) || SPLIT_PART(SPLIT_PART(\"METADATA$FILENAME\", '/',  -2), '=', -1), 'YYYYMMddHH')"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"FILENAME"},"2":{"slot":2,"type":"STRING","value":"VARCHAR"},"3":{"slot":3,"type":"STRING","value":""},"4":{"slot":4,"type":"STRING","value":""},"5":{"slot":5,"type":"STRING","value":"\"METADATA$FILENAME\""}}}},"values":{"1":{"slot":1,"type":"STRING","value":"partition_columns"},"2":{"slot":2,"type":"STRING","value":"values"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1229308":{"id":1229308,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":-720,"y":0,"width":32,"height":32,"inputConnectorIDs":[1229363],"outputSuccessConnectorIDs":[1229362],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Build table names"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"external_table = external_table.upper()\nexternal_metadata_table = f'{external_table}_VERSION_METADATA'\n\nprint(f'external_table: {external_table}')\ncontext.updateVariable('external_table', external_table)\n\nprint(f'external_metadata_table: {external_metadata_table}')\ncontext.updateVariable('external_metadata_table', external_metadata_table)\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1229309":{"id":1229309,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-320,"y":0,"width":32,"height":32,"inputConnectorIDs":[1229360],"outputSuccessConnectorIDs":[1229361],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create or refresh external metadata table"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create or Refresh External Table - 1-1 - Create or refresh"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"cloud_storage_url"},"2":{"slot":2,"type":"STRING","value":"${cloud_storage_url}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"target_database"},"2":{"slot":2,"type":"STRING","value":"${target_database}"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"target_schema"},"2":{"slot":2,"type":"STRING","value":"${target_schema}"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"snowflake_stage"},"2":{"slot":2,"type":"STRING","value":"${snowflake_stage}"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"external_table"},"2":{"slot":2,"type":"STRING","value":"${external_metadata_table}"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"file_type"},"2":{"slot":2,"type":"STRING","value":"JSON"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{"1":{"slot":1,"elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DATABASE"},"2":{"slot":2,"type":"STRING","value":"VARCHAR"},"3":{"slot":3,"type":"STRING","value":""},"4":{"slot":4,"type":"STRING","value":""},"5":{"slot":5,"type":"STRING","value":"SPLIT_PART(SPLIT_PART(\"METADATA$FILENAME\", '/',  -5), '=', -1)"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"SCHEMA"},"2":{"slot":2,"type":"STRING","value":"VARCHAR"},"3":{"slot":3,"type":"STRING","value":""},"4":{"slot":4,"type":"STRING","value":""},"5":{"slot":5,"type":"STRING","value":"SPLIT_PART(SPLIT_PART(\"METADATA$FILENAME\", '/',  -4), '=', -1)"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"TABLE"},"2":{"slot":2,"type":"STRING","value":"VARCHAR"},"3":{"slot":3,"type":"STRING","value":""},"4":{"slot":4,"type":"STRING","value":""},"5":{"slot":5,"type":"STRING","value":"SPLIT_PART(SPLIT_PART(\"METADATA$FILENAME\", '/',  -3), '=', -1)"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"VERSION"},"2":{"slot":2,"type":"STRING","value":"NUMBER"},"3":{"slot":3,"type":"STRING","value":""},"4":{"slot":4,"type":"STRING","value":""},"5":{"slot":5,"type":"STRING","value":"CAST(SPLIT_PART(SPLIT_PART(\"METADATA$FILENAME\", '/',  -2), '=', -1) AS NUMBER(38, 0))"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"FILENAME"},"2":{"slot":2,"type":"STRING","value":"VARCHAR"},"3":{"slot":3,"type":"STRING","value":""},"4":{"slot":4,"type":"STRING","value":""},"5":{"slot":5,"type":"STRING","value":"\"METADATA$FILENAME\""}}}},"values":{"1":{"slot":1,"type":"STRING","value":"partition_columns"},"2":{"slot":2,"type":"STRING","value":"values"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1229310":{"id":1229310,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-1120,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[1229366],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Start","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1229311":{"id":1229311,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":-160,"y":0,"width":32,"height":32,"inputConnectorIDs":[1229361],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"1229360":{"id":1229360,"sourceID":1229305,"targetID":1229309},"1229361":{"id":1229361,"sourceID":1229309,"targetID":1229311},"1229362":{"id":1229362,"sourceID":1229308,"targetID":1229305},"1229363":{"id":1229363,"sourceID":1229304,"targetID":1229308}},"failureConnectors":{},"unconditionalConnectors":{"1229366":{"id":1229366,"sourceID":1229310,"targetID":1229304}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{"1229301":{"id":1229301,"x":-553,"y":-154,"width":307,"height":229,"text":"**Create or refresh external tables**\n\nCreate or refresh the following tables\n\n- <external_table>\n- <external_table>_VERSION_METADATA","colour":"e6e63c"},"1229303":{"id":1229303,"x":-796,"y":-153,"width":151,"height":228,"text":"**Build table names**\n\nEnsure external table name is upper case.","colour":"e6e63c"},"1229306":{"id":1229306,"x":-1034,"y":-154,"width":150,"height":228,"text":"**Update [Environment Default] values**\n\nReplace any [Environment Default] parameters with the actual value","colour":"e6e63c"},"1229307":{"id":1229307,"x":-1834,"y":-154,"width":627,"height":387,"text":"**Change log**\n\n1.0.0 -----------------------------------------------------------------------------------------------------------\n- General availability\n- Support for S3 and Azure Blob Storage locations\n- Support for schema drift","colour":"00ce4f"}},"variables":{"cloud_storage_url":{"definition":{"name":"cloud_storage_url","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"external_metadata_table":{"definition":{"name":"external_metadata_table","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PRIVATE"},"value":""},"external_table":{"definition":{"name":"external_table","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"snowflake_stage":{"definition":{"name":"snowflake_stage","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":null},"target_database":{"definition":{"name":"target_database","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"[Environment Default]"},"target_schema":{"definition":{"name":"target_schema","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"[Environment Default]"}},"grids":{}},"info":{"name":"Create or Refresh External Table - 1 - Process","description":"Unpacked from Shared Job [Create or Refresh External Table].","type":"ORCHESTRATION","tag":"0b2c909a-a4af-4b2d-8779-e28e7a4f81cc"}}