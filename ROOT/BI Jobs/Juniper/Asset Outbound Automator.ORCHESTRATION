{"job":{"components":{"79334":{"id":79334,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":736,"y":0,"width":32,"height":32,"inputConnectorIDs":[79344],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"79335":{"id":79335,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-640,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[79348],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"79336":{"id":79336,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":16,"y":0,"width":32,"height":32,"inputConnectorIDs":[79347],"outputSuccessConnectorIDs":[79346],"outputFailureConnectorIDs":[79350],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"1) Outbound to SalesForce ASSET"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"1) Outbound to SalesForce ASSET"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"jv_max_last_update_ts"},"2":{"slot":2,"type":"STRING","value":"${jv_max_last_update_ts}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"jv_batch_id"},"2":{"slot":2,"type":"STRING","value":"${jv_batch_id}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"79337":{"id":79337,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1032749985,"x":-336,"y":0,"width":32,"height":32,"inputConnectorIDs":[79348],"outputSuccessConnectorIDs":[79347],"outputFailureConnectorIDs":[79361],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Max Last Update Timestamp/ BATCH_ID"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select max(\"MAX_EDP_LAST_UPDATED\")::TIMESTAMP_NTZ as MAX_EDP_LAST_UPDATED, \n       max(\"JOB_ID\") as BATCH_ID \nfrom   TAKEOFF.INSTALL_BASE_PRE_SFDC"}}}},"visible":true},"3":{"slot":3,"name":"Scalar Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"jv_max_last_update_ts"},"2":{"slot":2,"type":"STRING","value":"MAX_EDP_LAST_UPDATED"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"jv_batch_id"},"2":{"slot":2,"type":"STRING","value":"BATCH_ID"}}}},"visible":true},"4":{"slot":4,"name":"","elements":{},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"79338":{"id":79338,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":515156205,"x":400,"y":256,"width":32,"height":32,"inputConnectorIDs":[79345],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Failure"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"79339":{"id":79339,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":304,"y":0,"width":32,"height":32,"inputConnectorIDs":[79346],"outputSuccessConnectorIDs":[79342],"outputFailureConnectorIDs":[79360],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"1) Inbound to Asset Xref"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"1) Inbound to Asset Xref"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"jv_batch_id"},"2":{"slot":2,"type":"STRING","value":"${jv_batch_id}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"79340":{"id":79340,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":16,"y":256,"width":32,"height":32,"inputConnectorIDs":[79350,79360,79361],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[79349],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"79341":{"id":79341,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":576,"y":0,"width":32,"height":32,"inputConnectorIDs":[79342],"outputSuccessConnectorIDs":[79344],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SNS Message COMPLETED"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eu-west-1"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"matillion-phil"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AWS Notification Message - SalesForce ASSET Upsert COMPLETED"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Upsert was COMPLETED for batch ${jv_batch_id}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"79343":{"id":79343,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":240,"y":256,"width":32,"height":32,"inputConnectorIDs":[79349],"outputSuccessConnectorIDs":[79345],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SNS Message - ETL Failed"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eu-west-1"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"matillion-phil"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AWS Notification Message - ETL FAILED for ASSET Upsert"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"The ETL has failed for batch ${jv_batch_id}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"79342":{"id":79342,"sourceID":79339,"targetID":79341},"79344":{"id":79344,"sourceID":79341,"targetID":79334},"79345":{"id":79345,"sourceID":79343,"targetID":79338},"79346":{"id":79346,"sourceID":79336,"targetID":79339},"79347":{"id":79347,"sourceID":79337,"targetID":79336}},"failureConnectors":{"79350":{"id":79350,"sourceID":79336,"targetID":79340},"79360":{"id":79360,"sourceID":79339,"targetID":79340},"79361":{"id":79361,"sourceID":79337,"targetID":79340}},"unconditionalConnectors":{"79348":{"id":79348,"sourceID":79335,"targetID":79337},"79349":{"id":79349,"sourceID":79340,"targetID":79343}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{"79328":{"id":79328,"x":-214,"y":114,"width":688,"height":206,"text":"``Belt and Braces Approach``\n\nThis part of the ETL should not fail as it just setting the environment prior to the Salesforce Asset upsert operation.\n\nHowever, if it does we are capturing the issue and ending the ETL and firing off a SNS Failure message.","colour":"e6e63c"},"79330":{"id":79330,"x":-141,"y":-223,"width":309,"height":273,"text":"**Asset - Outbound from Snowflake to Salesforce**\n\n- Peforms upsert into Salesforce\n- Retry upserts x-number of times (based on **ev_retry_count **environment variable value)\n- Records last batch upsert timestamp in METADATA_LOOKUP table\n- Records Successful/ Failed Runs in JOB_STATUS table (with External Ids of failed records).\n- Sends out Fail SNS messages.","colour":"e6e63c"},"79331":{"id":79331,"x":-655,"y":124,"width":268,"height":74,"text":"NB; the Salesforce components in this ETL are using for authentication, username/password but can be easily replaced with OAuth.","colour":"d60000"},"79332":{"id":79332,"x":-541,"y":-257,"width":369,"height":310,"text":"**Starting Point from Delta population in INSTALL_BASE_PRE_SFDC **\n\nRetrieve the MAX last update value and the current BATCH_ID (JOB_ID) from the INSTALL_BASE_PRE_SFDC table. \n\nThis table contains the delta to upsert. However, it does not yet contain any SFDC_IDs.\n\nNB: At this point we are under the assumption that;\n- the INSTALL_BASE_PRE_SFDC, containing the delta\n- the INSTALL_BASE_DELTA_LOG tables have been populated.\n- the METADATA_LOOKUP table has an initial entry. It **MUST **have for the Juniper sproc that popualtes INSTALL_BASE_PRE_SFDC to work.\n\n**This job is driven off the delta population in INSTALL_BASE_PRE_SFDC.**","colour":"e6e63c"},"79333":{"id":79333,"x":188,"y":-222,"width":253,"height":274,"text":"**Inbound to populate ASSET_XREF Snowflake table with Salesforce SFDC_IDs.**\n\n- Downloads for the current batch the SFDC_ID's generated and the External Ids.\n- Upserts into ASSET_XREF and records timestamp.","colour":"e6e63c"}},"variables":{"jv_batch_id":{"definition":{"name":"jv_batch_id","type":"DECIMAL","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"0"},"jv_max_last_update_ts":{"definition":{"name":"jv_max_last_update_ts","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"    "}},"grids":{}},"info":{"name":"Asset Outbound Automator","description":"","type":"ORCHESTRATION","tag":"844820d6-c3a3-4c5e-b47c-04bb1b7d55fa"}}