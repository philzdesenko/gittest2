{"job":{"components":{"1234309":{"id":1234309,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-656,"y":-176,"width":32,"height":32,"inputConnectorIDs":[1234317],"outputSuccessConnectorIDs":[1234339],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SET A ROW TO BE BAD"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"update TAKEOFF.TMP_FINAL_INSTALL_BASE_PRE_SFDC set ACCOUNTID = 'BAD_ACCT4' WHERE CEC_EQUIPMENT_ID__C = '30000827774';\n\nupdate TAKEOFF.TMP_FINAL_INSTALL_BASE_PRE_SFDC set ACCOUNTID = 'BAD_ACCT6' WHERE CEC_EQUIPMENT_ID__C = '10025768627';"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1234312":{"id":1234312,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-1168,"y":-176,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[1234336],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1234313":{"id":1234313,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":515156205,"x":-912,"y":48,"width":32,"height":32,"inputConnectorIDs":[1234337],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Failure 1"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1234314":{"id":1234314,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"ITERATE","implementationID":-158614544,"x":-464,"y":-176,"width":32,"height":16,"inputConnectorIDs":[1234339],"outputSuccessConnectorIDs":[1234338],"outputFailureConnectorIDs":[1234342],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Retry 0"}}}},"visible":true},"2":{"slot":2,"name":"Number of Retries","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${ev_retry_count}"}}}},"visible":true},"3":{"slot":3,"name":"Retry Delay","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Short delay with backoff"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[1234343],"inputIterationConnectorIDs":[]},"1234315":{"id":1234315,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":-160,"y":-32,"width":32,"height":32,"inputConnectorIDs":[1234342],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success 1"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1234316":{"id":1234316,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-464,"y":-144,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Retry Salesorce Output Stage"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Retry Salesorce Output Stage"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"jv_end_upsert"},"2":{"slot":2,"type":"STRING","value":"${jv_end_upsert}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"jv_max_last_update_ts"},"2":{"slot":2,"type":"STRING","value":"${jv_max_last_update_ts}"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"jv_message"},"2":{"slot":2,"type":"STRING","value":"${jv_message}"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"jv_object_name"},"2":{"slot":2,"type":"STRING","value":"${jv_object_name}"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"jv_operation"},"2":{"slot":2,"type":"STRING","value":"${jv_operation}"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"jv_rowcount_upsert"},"2":{"slot":2,"type":"STRING","value":"${jv_rowcount_upsert}"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"jv_start_upsert"},"2":{"slot":2,"type":"STRING","value":"${jv_start_upsert}"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"jv_status"},"2":{"slot":2,"type":"STRING","value":"${jv_status}"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"jv_batch_id"},"2":{"slot":2,"type":"STRING","value":"${jv_batch_id}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[1234343]},"1234318":{"id":1234318,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":-912,"y":-176,"width":32,"height":32,"inputConnectorIDs":[1234336],"outputSuccessConnectorIDs":[1234317],"outputFailureConnectorIDs":[1234337],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Prepare Asset data for upsert 0"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Prepare Asset data for upsert"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1234319":{"id":1234319,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":-160,"y":-320,"width":32,"height":32,"inputConnectorIDs":[1234338],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"1234317":{"id":1234317,"sourceID":1234318,"targetID":1234309},"1234338":{"id":1234338,"sourceID":1234314,"targetID":1234319},"1234339":{"id":1234339,"sourceID":1234309,"targetID":1234314}},"failureConnectors":{"1234337":{"id":1234337,"sourceID":1234318,"targetID":1234313},"1234342":{"id":1234342,"sourceID":1234314,"targetID":1234315}},"unconditionalConnectors":{"1234336":{"id":1234336,"sourceID":1234312,"targetID":1234318}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{"1234343":{"id":1234343,"sourceID":1234314,"targetID":1234316}},"noteConnectors":{},"notes":{"1234304":{"id":1234304,"x":-264,"y":-238,"width":228,"height":260,"text":"We are setting the status here to SUCCESS.\n\nThe reason being is that we do no want this Orchestration to propagate back up to the calling job a failure. If a number of batch records fail to upsert, we still want those that succeeded to have their SFCD_IDs downloaded to Snowflake.\n\nBatch upsert errors will be reported back via SNS messages anyways.","colour":"e6e63c"},"1234305":{"id":1234305,"x":-1060,"y":-382,"width":272,"height":40,"text":"**``Upsert to SalesForce Asset Object``**","colour":"d60000"},"1234307":{"id":1234307,"x":-551,"y":-381,"width":236,"height":322,"text":"Retry connectivity to SalesForce for Upsert/Select component operations.\n\nNumber of iterations controlled by environment variable **ev_retry_count  **(NB first iteration is Zero, so setting of 2 means 3 iterations performed).\nSetting **ev_retry_count = 0  **will disable Retry iterations.","colour":"f9c21b"},"1234308":{"id":1234308,"x":-1074,"y":-303,"width":319,"height":183,"text":"The transformation sources the SFDC_ID's from the ACCOUNT_XREF and PRODUCT_XREF tables and rewrites in the TAKEOFF schema an ID populated temp table named **TMP_FINAL_INSTALL_BASE_PRE_SFDC**\n\nThis table is now ready for Upsert by the following component.","colour":"e6e63c"},"1234310":{"id":1234310,"x":-715,"y":-292,"width":116,"height":170,"text":"NB: this component only here to mimic BAD data and upsert failures for testing.\n**Please DELETE from live jobs.**","colour":"d60000"},"1234311":{"id":1234311,"x":-1075,"y":-85,"width":321,"height":170,"text":"``Belt and Braces Approach``\n\nThis part of the ETL should not fail as it just setting the environment prior to the Salesforce Asset upsert operation.\n\nHowever, if it does we are capturing the issue and ending the ETL and firing off a SNS Failure message.","colour":"e6e63c"}},"variables":{"jv_batch_id":{"definition":{"name":"jv_batch_id","type":"DECIMAL","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"0"},"jv_end_upsert":{"definition":{"name":"jv_end_upsert","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"jv_max_last_update_ts":{"definition":{"name":"jv_max_last_update_ts","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"jv_message":{"definition":{"name":"jv_message","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"none"},"jv_object_name":{"definition":{"name":"jv_object_name","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"ASSET"},"jv_operation":{"definition":{"name":"jv_operation","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"OUTBOUND_FROM_SNOWFLAKE"},"jv_rowcount_upsert":{"definition":{"name":"jv_rowcount_upsert","type":"DECIMAL","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"0"},"jv_start_upsert":{"definition":{"name":"jv_start_upsert","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""},"jv_status":{"definition":{"name":"jv_status","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""}},"grids":{}},"info":{"name":"1) Outbound to SalesForce ASSET","description":"","type":"ORCHESTRATION","tag":"b5a48c9c-f268-407a-bd25-69b572a5e691"}}