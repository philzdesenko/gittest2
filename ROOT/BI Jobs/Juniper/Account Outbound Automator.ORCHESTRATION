{"job":{"components":{"79304":{"id":79304,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-768,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[79322],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"79306":{"id":79306,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":736,"y":0,"width":32,"height":32,"inputConnectorIDs":[79320],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"79307":{"id":79307,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":304,"y":0,"width":32,"height":32,"inputConnectorIDs":[79317],"outputSuccessConnectorIDs":[79318],"outputFailureConnectorIDs":[79326],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"1) Inbound to Account Xref"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"1) Inbound to Account Xref"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"jv_batch_id"},"2":{"slot":2,"type":"STRING","value":"${jv_batch_id}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"79308":{"id":79308,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":240,"y":256,"width":32,"height":32,"inputConnectorIDs":[79325],"outputSuccessConnectorIDs":[79316],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SNS Message - ETL Failed"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eu-west-1"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"matillion-phil"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AWS Notification Message - ETL FAILED for ASSET Upsert"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"The ETL has failed for batch ${jv_batch_id}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"79309":{"id":79309,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":16,"y":0,"width":32,"height":32,"inputConnectorIDs":[79319],"outputSuccessConnectorIDs":[79317],"outputFailureConnectorIDs":[79327],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"1) Outbound to SalesForce Account"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"1) Outbound to SalesForce ACCOUNT"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"jv_max_last_update_ts"},"2":{"slot":2,"type":"STRING","value":"${jv_max_last_update_ts}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"jv_batch_id"},"2":{"slot":2,"type":"STRING","value":"${jv_batch_id}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"79310":{"id":79310,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1032749985,"x":-416,"y":0,"width":32,"height":32,"inputConnectorIDs":[79321],"outputSuccessConnectorIDs":[79323],"outputFailureConnectorIDs":[79324],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Max Last Update Timestamp/ BATCH_ID"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select max(\"LastModifiedDate\")::TIMESTAMP_NTZ as MAX_EDP_LAST_UPDATED, \n       TO_NUMBER(max(\"SicDesc\")) as BATCH_ID \nfrom   TAKEOFF.TMP_FINAL_INSTALL_ACCOUNT"}}}},"visible":true},"3":{"slot":3,"name":"Scalar Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"jv_max_last_update_ts"},"2":{"slot":2,"type":"STRING","value":"MAX_EDP_LAST_UPDATED"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"jv_batch_id"},"2":{"slot":2,"type":"STRING","value":"BATCH_ID"}}}},"visible":true},"4":{"slot":4,"name":"","elements":{},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"79311":{"id":79311,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":515156205,"x":400,"y":256,"width":32,"height":32,"inputConnectorIDs":[79316],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Failure"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"79312":{"id":79312,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-640,"y":0,"width":32,"height":32,"inputConnectorIDs":[79322],"outputSuccessConnectorIDs":[79321],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SET BAD ROWS"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"update TAKEOFF.TMP_FINAL_INSTALL_ACCOUNT set \"Id\" = 'BAD_ACCT1' WHERE \"Id\" = '0013z00002OjPtuAAF';\n\nupdate TAKEOFF.TMP_FINAL_INSTALL_ACCOUNT set \"Id\" = 'BAD_ACCT2' WHERE \"Id\" = '0013z00002SZuTZAA1';\n\nupdate TAKEOFF.TMP_FINAL_INSTALL_ACCOUNT set \"SicDesc\" = '2';"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"79313":{"id":79313,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":16,"y":256,"width":32,"height":32,"inputConnectorIDs":[79324,79326,79327],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[79325],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"79314":{"id":79314,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-240,"y":0,"width":32,"height":32,"inputConnectorIDs":[79323],"outputSuccessConnectorIDs":[79319],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python Script 0"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\nprint(\"Max last date\") + jv_max_last_update_ts\nprint(\"Batch Id: \") + str(jv_batch_id)"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 2"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"79315":{"id":79315,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":576,"y":0,"width":32,"height":32,"inputConnectorIDs":[79318],"outputSuccessConnectorIDs":[79320],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SNS Message COMPLETED"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eu-west-1"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"matillion-phil"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AWS Notification Message - SalesForce ASSET Upsert COMPLETED"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Upsert was COMPLETED for batch ${jv_batch_id}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"79316":{"id":79316,"sourceID":79308,"targetID":79311},"79317":{"id":79317,"sourceID":79309,"targetID":79307},"79318":{"id":79318,"sourceID":79307,"targetID":79315},"79319":{"id":79319,"sourceID":79314,"targetID":79309},"79320":{"id":79320,"sourceID":79315,"targetID":79306},"79321":{"id":79321,"sourceID":79312,"targetID":79310},"79323":{"id":79323,"sourceID":79310,"targetID":79314}},"failureConnectors":{"79324":{"id":79324,"sourceID":79310,"targetID":79313},"79326":{"id":79326,"sourceID":79307,"targetID":79313},"79327":{"id":79327,"sourceID":79309,"targetID":79313}},"unconditionalConnectors":{"79322":{"id":79322,"sourceID":79304,"targetID":79312},"79325":{"id":79325,"sourceID":79313,"targetID":79308}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{"79298":{"id":79298,"x":-214,"y":114,"width":688,"height":206,"text":"``Belt and Braces Approach``\n\nThis part of the ETL should not fail as it just setting the environment prior to the Salesforce Asset upsert operation.\n\nHowever, if it does we are capturing the issue and ending the ETL and firing off a SNS Failure message.","colour":"e6e63c"},"79300":{"id":79300,"x":-141,"y":-223,"width":309,"height":273,"text":"**Account - Outbound from Snowflake to Salesforce**\n\n- Peforms upsert into Salesforce\n- Retry upserts x-number of times (based on **ev_retry_count **environment variable value)\n- Records last batch upsert timestamp in METADATA_LOOKUP table\n- Records Successful/ Failed Runs in JOB_STATUS table (with External Ids of failed records).\n- Sends out Fail SNS messages.","colour":"e6e63c"},"79301":{"id":79301,"x":-541,"y":-257,"width":369,"height":310,"text":"**Starting Point from Delta population in INSTALL_BASE_PRE_SFDC **\n\nRetrieve the MAX last update value and the current BATCH_ID (JOB_ID) from the INSTALL_BASE_PRE_SFDC table. \n\nThis table contains the delta to upsert. However, it does not yet contain any SFDC_IDs.\n\nNB: At this point we are under the assumption that;\n- the INSTALL_BASE_PRE_SFDC, containing the delta\n- the INSTALL_BASE_DELTA_LOG tables have been populated.\n- the METADATA_LOOKUP table has an initial entry. It **MUST **have for the Juniper sproc that populates INSTALL_BASE_PRE_SFDC to work.\n\n**This job is driven off the delta population in INSTALL_BASE_PRE_SFDC.**","colour":"e6e63c"},"79302":{"id":79302,"x":188,"y":-222,"width":253,"height":274,"text":"**Inbound to populate ACCOUNT_XREF Snowflake table with Salesforce SFDC_IDs.**\n\n- Downloads for the current batch the SFDC_ID's generated and the External Ids.\n- Upserts into ASSET_XREF and records timestamp.","colour":"e6e63c"},"79303":{"id":79303,"x":-698,"y":-118,"width":116,"height":170,"text":"NB: this component only here to mimic BAD data and upsert failures for testing.\n**Please DELETE from live jobs.**","colour":"d60000"},"79305":{"id":79305,"x":-655,"y":124,"width":268,"height":74,"text":"NB; the Salesforce components in this ETL are using for authentication, username/password but can be easily replaced with OAuth.","colour":"d60000"}},"variables":{"jv_batch_id":{"definition":{"name":"jv_batch_id","type":"DECIMAL","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"0"},"jv_max_last_update_ts":{"definition":{"name":"jv_max_last_update_ts","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"    "}},"grids":{}},"info":{"name":"Account Outbound Automator","description":"","type":"ORCHESTRATION","tag":"0e3e3912-ddcb-4f66-8044-10aeaef4aa66"}}