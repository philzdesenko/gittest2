{"job":{"components":{"80722":{"id":80722,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1838652813,"x":160,"y":208,"width":32,"height":32,"inputConnectorIDs":[80731],"outputConnectorIDs":[80730],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Convert Type"}}}},"visible":true},"2":{"slot":2,"name":"Conversions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ComponentID"},"2":{"slot":2,"type":"STRING","value":"NUMBER"},"3":{"slot":3,"type":"INTEGER","value":"10"},"4":{"slot":4,"type":"INTEGER","value":""}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"80724":{"id":80724,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":416069678,"x":-160,"y":208,"width":32,"height":32,"inputConnectorIDs":[80728],"outputConnectorIDs":[80731],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Flatten PROJECT JSON"}}}},"visible":true},"2":{"slot":2,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"objects"},"2":{"slot":2,"type":"STRING","value":"description"},"3":{"slot":3,"type":"STRING","value":"VARCHAR"},"4":{"slot":4,"type":"STRING","value":"Version"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"jobs"},"2":{"slot":2,"type":"STRING","value":"info:id"},"3":{"slot":3,"type":"STRING","value":"NUMBER"},"4":{"slot":4,"type":"STRING","value":"JobID"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"jobs"},"2":{"slot":2,"type":"STRING","value":"info:name"},"3":{"slot":3,"type":"STRING","value":"VARCHAR"},"4":{"slot":4,"type":"STRING","value":"JobName"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"jobs"},"2":{"slot":2,"type":"STRING","value":"jobObject:JobType"},"3":{"slot":3,"type":"STRING","value":"VARCHAR"},"4":{"slot":4,"type":"STRING","value":"JobType"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"jobs"},"2":{"slot":2,"type":"STRING","value":"jobObject:created"},"3":{"slot":3,"type":"STRING","value":"NUMBER"},"4":{"slot":4,"type":"STRING","value":"DateCreated"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"jobs"},"2":{"slot":2,"type":"STRING","value":"jobObject:timestamp"},"3":{"slot":3,"type":"STRING","value":"NUMBER"},"4":{"slot":4,"type":"STRING","value":"Timestamp_DT"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"components"},"2":{"slot":2,"type":"STRING","value":"implementationID"},"3":{"slot":3,"type":"STRING","value":"NUMBER"},"4":{"slot":4,"type":"STRING","value":"ComponentID"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"jobs"},"2":{"slot":2,"type":"STRING","value":"path"},"3":{"slot":3,"type":"STRING","value":"VARIANT"},"4":{"slot":4,"type":"STRING","value":"JobPath"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"components"},"2":{"slot":2,"type":"STRING","value":"executionHint"},"3":{"slot":3,"type":"STRING","value":"VARCHAR"},"4":{"slot":4,"type":"STRING","value":"ComponentType"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"parameters"},"2":{"slot":2,"type":"STRING","value":"name"},"3":{"slot":3,"type":"STRING","value":"VARCHAR"},"4":{"slot":4,"type":"STRING","value":"parameterName"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"elementValues"},"2":{"slot":2,"type":"STRING","value":"value"},"3":{"slot":3,"type":"STRING","value":"VARCHAR"},"4":{"slot":4,"type":"STRING","value":"elementValue"}}}},"visible":true},"3":{"slot":3,"name":"Column Flattens","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"JSON_PROJECT"},"2":{"slot":2,"type":"STRING","value":"objects"},"3":{"slot":3,"type":"STRING","value":"objects"},"4":{"slot":4,"type":"STRING","value":"false"},"5":{"slot":5,"type":"STRING","value":"false"},"6":{"slot":6,"type":"STRING","value":"both"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"objects"},"2":{"slot":2,"type":"STRING","value":"jobs.objects"},"3":{"slot":3,"type":"STRING","value":"jobs"},"4":{"slot":4,"type":"STRING","value":"false"},"5":{"slot":5,"type":"STRING","value":"false"},"6":{"slot":6,"type":"STRING","value":"both"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"jobs"},"2":{"slot":2,"type":"STRING","value":"jobObject.components"},"3":{"slot":3,"type":"STRING","value":"components"},"4":{"slot":4,"type":"STRING","value":"false"},"5":{"slot":5,"type":"STRING","value":"false"},"6":{"slot":6,"type":"STRING","value":"both"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"components"},"2":{"slot":2,"type":"STRING","value":"parameters"},"3":{"slot":3,"type":"STRING","value":"parameters"},"4":{"slot":4,"type":"STRING","value":"false"},"5":{"slot":5,"type":"STRING","value":"false"},"6":{"slot":6,"type":"STRING","value":"both"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"parameters"},"2":{"slot":2,"type":"STRING","value":"elements"},"3":{"slot":3,"type":"STRING","value":"elements"},"4":{"slot":4,"type":"STRING","value":"false"},"5":{"slot":5,"type":"STRING","value":"false"},"6":{"slot":6,"type":"STRING","value":"both"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"elements"},"2":{"slot":2,"type":"STRING","value":"values"},"3":{"slot":3,"type":"STRING","value":"elementValues"},"4":{"slot":4,"type":"STRING","value":"false"},"5":{"slot":5,"type":"STRING","value":"false"},"6":{"slot":6,"type":"STRING","value":"both"}}}},"visible":true},"4":{"slot":4,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"80725":{"id":80725,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":335239555,"x":784,"y":208,"width":32,"height":32,"inputConnectorIDs":[80729],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Rewrite Table: MATILLION_JSON_FLATTENED"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"MATILLION_JSON_FLATTENED"}}}},"visible":true},"6":{"slot":6,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${job_database}"}}}},"visible":true},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${job_schema}"}}}},"visible":true},"8":{"slot":8,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"80726":{"id":80726,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":448,"y":208,"width":32,"height":32,"inputConnectorIDs":[80730],"outputConnectorIDs":[80729],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Transform EPOCH dates & ETL Path"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DATEADD(MS, \"DateCreated\", 0::TIMESTAMP)"},"2":{"slot":2,"type":"STRING","value":"DateCreated"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"DATEADD(MS, \"Timestamp_DT\", 0::TIMESTAMP)"},"2":{"slot":2,"type":"STRING","value":"Timestamp_DT"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"array_to_string(\"JobPath\",'/')"},"2":{"slot":2,"type":"STRING","value":"JobPath"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"80727":{"id":80727,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":-496,"y":208,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[80728],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"MATILLION_PROJECTS_JSON"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"MATILLION_PROJECTS_JSON"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"JSON_PROJECT"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${job_schema}"}}}},"visible":true},"6":{"slot":6,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${job_database}"}}}},"visible":true},"7":{"slot":7,"name":"Offset","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"80728":{"id":80728,"sourceID":80727,"targetID":80724},"80729":{"id":80729,"sourceID":80726,"targetID":80725},"80730":{"id":80730,"sourceID":80722,"targetID":80726},"80731":{"id":80731,"sourceID":80724,"targetID":80722}},"notes":{"80716":{"id":80716,"x":-597,"y":-33,"width":914,"height":85,"text":"**Flatten json to element value**\n\nThis transformation job takes the json generated by the Matillion API export endpoint and uses the Snowflake specific lateral flatten function to parse this into individual columns. \n\nThe result is then output to a temporary table named MATILLION_JSON_FLATTENED for further processing.","colour":"00ce4f"},"80717":{"id":80717,"x":-368,"y":300,"width":435,"height":293,"text":"**SF query equivalent used to  construct Flatten Variant component properties**\n\nSELECT \n    objects.value:description::string as version  \n    ,jobs.value:info:name::string as JobName\n    ,jobs.value:jobObject:JobType::string as JobType\n    ,jobs.value:jobObject:created::number as DateCreated\n    ,jobs.value:jobObject:timestamp::number as TimeStamp    \n    ,jobs.value:info:id::number as JobId\n    ,components.value:implementationID::number as ComponentId\n    ,elementValues.value:value as elementValue\n    ,array_to_string(jobs.value:path,'/')\nFROM \n\tMATILLION_PROJECTS_JSON,\n\tlateral flatten(JSON_PROJECT:objects) as objects,\n    lateral flatten(objects.value:jobs:objects) as jobs,\n    lateral flatten(jobs.value:jobObject:components) as components  ,\n    lateral flatten(components.value:parameters) as parameters,\n    lateral flatten(parameters.value:elements) as elements,\n    lateral flatten(elements.value:values) as elementValues","colour":"f9c21b"},"80718":{"id":80718,"x":321,"y":111,"width":258,"height":146,"text":"Add derived columns. Note the use of the 'array_to_string' function for parsing the job path","colour":"e6e63c"},"80719":{"id":80719,"x":60,"y":116,"width":198,"height":140,"text":"Use a convert type to set a sensible datatype of NUMBER(10,0) for the ComponentID column","colour":"e6e63c"},"80720":{"id":80720,"x":-279,"y":112,"width":248,"height":143,"text":"The 'Flatten Variant' component uses the Snowflake lateral flatten function to read the provided json and generate output columns based on the specification provided","colour":"e6e63c"},"80721":{"id":80721,"x":-594,"y":139,"width":211,"height":118,"text":"Read the json from the variant column loaded in the parent orchestration","colour":"e6e63c"},"80723":{"id":80723,"x":664,"y":111,"width":235,"height":142,"text":"Load the output into a temporary table named MATILLION_JSON_FLATTENED","colour":"e6e63c"}},"noteConnectors":{},"variables":{"job_database":{"definition":{"name":"job_database","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"PZ_DATABASE"},"job_schema":{"definition":{"name":"job_schema","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"TRAIN"},"job_warehouse":{"definition":{"name":"job_warehouse","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"TEST_WH"}},"grids":{}},"info":{"name":"Flatten json to element value","description":"","type":"TRANSFORMATION","tag":"3fe5854f-d2e0-4187-85a6-0e7a49dfdd7f"}}