{"job":{"components":{"1228580":{"id":1228580,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-1184,"y":176,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[1228586],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Start","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1228582":{"id":1228582,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1211855512,"x":-800,"y":176,"width":32,"height":32,"inputConnectorIDs":[1228581],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Refresh External Table 0"}}}},"visible":true},"2":{"slot":2,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"3":{"slot":3,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"4":{"slot":4,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"NEW_PHIL_TEST"}}}},"visible":true},"5":{"slot":5,"name":"Relative Subpath","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1228583":{"id":1228583,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1364466516,"x":-992,"y":176,"width":32,"height":32,"inputConnectorIDs":[1228586],"outputSuccessConnectorIDs":[1228581],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create External Table 0"}}}},"visible":true},"2":{"slot":2,"name":"Create/Replace","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Replace"}}}},"visible":true},"3":{"slot":3,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"4":{"slot":4,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"5":{"slot":5,"name":"New Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"NEW_PHIL_TEST"}}}},"visible":true},"8":{"slot":8,"name":"Partition Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DATE_VAR"},"2":{"slot":2,"type":"STRING","value":"DATE"},"3":{"slot":3,"type":"INTEGER","value":""},"4":{"slot":4,"type":"INTEGER","value":""},"5":{"slot":5,"type":"STRING","value":"to_date(substr(\"METADATA$FILENAME\", 13, 10), 'YYYY/MM/DD')"}}}},"visible":true},"9":{"slot":9,"name":"Pattern","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"10":{"slot":10,"name":"Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Custom]"}}}},"visible":true},"11":{"slot":11,"name":"File Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CSV"}}}},"visible":true},"12":{"slot":12,"name":"Compression","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AUTO"}}}},"visible":true},"20":{"slot":20,"name":"Record Delimiter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"21":{"slot":21,"name":"Field Delimiter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"22":{"slot":22,"name":"Skip Header","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"1"}}}},"visible":true},"26":{"slot":26,"name":"","elements":{},"visible":false},"27":{"slot":27,"name":"Escape","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"CHAR_OR_ESCAPE_SEQUENCE","value":""}}}},"visible":true},"28":{"slot":28,"name":"Escape Unenclosed Field","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"CHAR_OR_ESCAPE_SEQUENCE","value":""}}}},"visible":true},"29":{"slot":29,"name":"Trim Space","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"30":{"slot":30,"name":"Field Optionally Enclosed","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"CHAR","value":""}}}},"visible":true},"31":{"slot":31,"name":"Null If","elements":{},"visible":true},"32":{"slot":32,"name":"Error On Column Count Mismatch","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"33":{"slot":33,"name":"Empty Field as Null","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"True"}}}},"visible":true},"34":{"slot":34,"name":"Encoding Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"35":{"slot":35,"name":"Skip Blank Lines","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"36":{"slot":36,"name":"Replace Invalid Characters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":true},"40":{"slot":40,"name":"Enable Octal","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"41":{"slot":41,"name":"Allow Duplicates","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"42":{"slot":42,"name":"Strip Outer Array","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"43":{"slot":43,"name":"Strip Null Values","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"44":{"slot":44,"name":"Ignore UTF8 Errors","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"45":{"slot":45,"name":"Nest Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"46":{"slot":46,"name":"Null If","elements":{},"visible":false},"47":{"slot":47,"name":"Trim Space","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"50":{"slot":50,"name":"Null If","elements":{},"visible":false},"51":{"slot":51,"name":"Trim Space","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"60":{"slot":60,"name":"Ignore UTF8 Errors","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"61":{"slot":61,"name":"Preserve Space","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"62":{"slot":62,"name":"Strip Outer Element","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"63":{"slot":63,"name":"Disable Snowflake Data","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"64":{"slot":64,"name":"Disable Auto Convert","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"66":{"slot":66,"name":"Null If","elements":{},"visible":false},"67":{"slot":67,"name":"Trim Space","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"70":{"slot":70,"name":"Null If","elements":{},"visible":false},"71":{"slot":71,"name":"Trim Space","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"False"}}}},"visible":false},"100":{"slot":100,"name":"Stage Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"PZ_DATABASE"}}}},"visible":true},"101":{"slot":101,"name":"Stage Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"TRAIN"}}}},"visible":true},"102":{"slot":102,"name":"Stage","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"STG_TEST"}}}},"visible":true},"103":{"slot":103,"name":"Relative Path","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"1228581":{"id":1228581,"sourceID":1228583,"targetID":1228582}},"failureConnectors":{},"unconditionalConnectors":{"1228586":{"id":1228586,"sourceID":1228580,"targetID":1228583}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{"1228576":{"id":1228576,"x":-1251,"y":-244,"width":653,"height":459,"text":"Interesting...\n\nI have a S3 bucket in the format;\n\ns3://bi-services-testing-pz-sf-s3bucket-tfpgc8an36yd/dummy_files/YYYY/MM/DD\ne.g.\ns3://bi-services-testing-pz-sf-s3bucket-tfpgc8an36yd/dummy_files/2021/01/01\n\nWhen you create a partition it must be based on  the METADATA$FILENAME\nThis value for my buckets is;\ndummy_files/2021/01/02/my_file20210101.csv\ndummy_files/2021/01/02/my_file20210102.csv\n\nThe External Partiiton must extract the date path from the above paths.\nTherefore the partition value is;\n\nto_date(substr(\"METADATA$FILENAME\", 13, 10), 'YYYY/MM/DD')\n\nwhich extracts 2021/01/02 and then convert to date and to an actual column to query on!\n\nYou then have 2 columns produced;\n1) VALUE containing your CSV \n2) DATE_VAR ...which is the column name I gave to the partition value extracted. This the allows you to include a date in the filtering.\n\nUnfortunately, the Matillion component does not allow you to flatten the data within the external table creation, which looks like you can do in Snowflake directly.","colour":"d60000"},"1228577":{"id":1228577,"x":-572,"y":-246,"width":598,"height":394,"text":"In order to use the 'Managed Stages' option, I had to go to the snowflake console and then as the ADMINUSER do the following;\n\nshow integrations;\n\ncreate storage integration S3_EXAMPLE\nTYPE = EXTERNAL_STAGE\nSTORAGE_PROVIDER = S3\nstorage_aws_role_arn  = 'arn:aws:iam::296772720564:role/bi-sso'\nenabled = true\nstorage_allowed_locations = ('s3://bi-services-testing-pz-sf-s3bucket-tfpgc8an36yd','s3://bi-services-testing-pz-sf-s3bucket-tfpgc8an36yd/dummy_files/');\n\ncreate stage EXAMPLE_STAGE\n  url='s3://bi-services-testing-pz-sf-s3bucket-tfpgc8an36yd/dummy_files/'\n  storage_integration = S3_EXAMPLE;\n\nSHOW STAGES;\ngrant ownership on stage EXAMPLE_STAGE TO PUBLIC;\n\nthen the stage was visible in Managed Stages under the environment. I can now create an  External Table.\n\n\n**Once my Matillion long term credential where created.. I could create a stage here and then the External Table","colour":"e6e63c"},"1228579":{"id":1228579,"x":-570,"y":174,"width":592,"height":40,"text":"https://www.matillion.com/resources/blog/how-matillion-etl-for-snowflake-supports-external-tables","colour":"f9c21b"}},"variables":{},"grids":{}},"info":{"name":"external table create","description":"","type":"ORCHESTRATION","tag":"916578d2-8454-492c-bfd2-46be6792b594"}}